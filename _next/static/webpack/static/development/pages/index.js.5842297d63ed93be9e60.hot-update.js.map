{"version":3,"file":"static/webpack/static/development/pages/index.js.5842297d63ed93be9e60.hot-update.js","sources":["webpack:///./components/react-map-gl/index.js"],"sourcesContent":["import React, {useState, useCallback, useContext} from 'react'\nimport Link from 'next/link'\nimport ReactMapGL, {Source, Layer, Popup} from 'react-map-gl'\nimport {Maximize2} from 'react-feather'\n\nimport {AppContext} from '../../pages'\n\nimport MapSelector from '../map-selector'\n\nimport SumUp from './sumup'\nimport Statistics from '../statistics'\n\nconst SITE_URL = process.env.SITE_URL\n\nconst settings = {\n  maxZoom: 10\n}\n\nconst Map = () => {\n  const [selectedMapIdx, setSelectedMapIdx] = useState(1)\n\n  const {\n    selectedLocationReport,\n    setSelectedLocation,\n    isIframe,\n    viewport,\n    maps,\n    setViewport,\n    isMobileDevice\n  } = useContext(AppContext)\n\n  const [map, setMap] = useState()\n  const [hovered, setHovered] = useState(null)\n\n  const mapRef = useCallback(ref => {\n    if (ref) {\n      setMap(ref.getMap())\n    }\n  }, [])\n\n  const onHover = event => {\n    event.stopPropagation()\n    const feature = event.features && event.features[0]\n    const [longitude, latitude] = event.lngLat\n    let hoverInfo\n\n    if (feature) {\n      hoverInfo = {\n        longitude,\n        latitude,\n        feature\n      }\n    }\n\n    setHovered(hoverInfo)\n  }\n\n  const onClick = event => {\n    event.stopPropagation()\n    const feature = event.features && event.features[0]\n\n    if (feature) {\n      const {properties} = feature\n      routing(selectedMapIdx, properties)\n      setSelectedLocation(properties.code)\n    } else {\n      setSelectedLocation(null)\n    }\n\n    setHovered(null)\n  }\n  const ref = React.createRef();\n\n  const MyButton = React.forwardRef(({ onClick, href }, ref) => {\n    return (\n      <a href={href} onClick={onClick} ref={ref}>\n        Click Me\n      </a>\n    )\n  })\n\n  const routing = (selectedMapIdx, properties) => {\n    const regions = selectedMapIdx >= 0 && selectedMapIdx <= 3\n \n    \n  }\n\n  return (\n    <div className='map-container'>\n      <div className='controls'>\n        <div className='control'>\n          <MapSelector mapIdx={selectedMapIdx} selectMap={setSelectedMapIdx} />\n        </div>\n\n        {isIframe && (\n          <div className='control maximize'>\n            <a href={SITE_URL} target='_top'><Maximize2 style={{verticalAlign: 'middle'}} /></a>\n          </div>\n        )}\n      </div>\n\n      <ReactMapGL\n        reuseMaps\n        ref={mapRef}\n        {...viewport}\n        width='100%'\n        height='100%'\n        mapStyle='https://etalab-tiles.fr/styles/osm-bright/style.json'\n        {...settings}\n        interactiveLayerIds={maps[selectedMapIdx].layers.map(layer => layer.id)}\n        onViewportChange={setViewport}\n        onHover={isMobileDevice ? null : onHover}\n        onClick={onClick}\n      >\n\n        <Source\n          type='geojson'\n          id='cas-confirmes'\n          attribution='Données Santé publique France'\n          data={maps[selectedMapIdx].data}\n        >\n          {maps[selectedMapIdx].layers.map(layer => (\n            <Layer key={layer.id} {...layer} />\n          ))}\n        </Source>\n\n        {hovered && (\n          \n          <Link href=\"/post/[pid]\" as={`/post/${pid}`}>\n            <Popup\n              longitude={hovered.longitude}\n              latitude={hovered.latitude}\n              closeButton={false}\n              closeOnClick={false}\n              onClose={() => setHovered(null)}\n              anchor='bottom-left'\n              ref={ref}\n            >\n              <SumUp nom={hovered.feature.properties.nom} />\n            </Popup>\n          </Link>\n        )}\n      </ReactMapGL>\n\n      {isMobileDevice && (\n        <div className={`mobile-sumup ${selectedLocationReport ? 'show' : 'hide'}`}>\n          {selectedLocationReport && (\n            <Statistics />\n          )}\n        </div>\n      )}\n\n      <style jsx>{`\n        .map-container {\n          position: relative;\n          width: 100%;\n          height: 100%;\n        }\n\n        .controls {\n          z-index: 1;\n          position: absolute;\n          display: flex;\n          justify-content: space-between;\n          align-items: start;\n          width: 100%;\n          padding: 0.5em;\n        }\n\n        .control {\n          background-color: #000000aa;\n          color: #fff;\n          border-radius: 4px;\n          margin: 0;\n        }\n\n        .maximize {\n          display: flex;\n          right: 0;\n          border-radius: 4px;\n          background: #53514f;\n        }\n\n        .maximize a {\n          color: #fff;\n          padding: 0.4em;\n        }\n\n        .mobile-sumup {\n          z-index: 2;\n          position: absolute;\n          bottom: 0;\n          background-color: #fff;\n          width: 100%;\n          margin: auto;\n          transition: 0.5s;\n        }\n\n        .mobile-sumup.hide {\n          height: 0;\n          padding: 0;\n        }\n\n        .mobile-sumup.show {\n          height: 100%;\n        }\n      `}</style>\n    </div>\n  )\n}\n\nexport default Map\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAEA;AAEA;AACA;AADA;AACA;AAGA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AACA;AAFA;AAIA;AACA;AACA;AANA;AAQA;AAAA;AAAA;AACA;AACA;AACA;AAXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAeA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAPA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AA3DA;AAAA;AAAA;AAyHA;AACA;AACA;;;;A","sourceRoot":""}